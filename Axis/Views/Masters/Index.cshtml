
@model IEnumerable<spGet_MastersMain_Result>
@{
    ViewBag.Title = "The Masters";
}
@section scripts {
    <script type="text/javascript">
        var EventsTable;
        var BadgeTable;
        var HistoryTable;

        function fn_ScanIn(Badge)
        {
            var URL = "ScanIn?Badge=" + Badge;
            $("#myPleaseWait").modal('show');
            $.ajax({
                url: URL,
                async: false,
                type: 'GET',
                success: function (result) {
                    if (result == "Success") {
                        $("#myPleaseWait").modal('hide');
                        $("#ScanIn").val('');
                        fn_ChangeDates();
                    } else {
                        alert(result);
                        $("#myPleaseWait").modal('hide');
                        $("#ScanIn").focus();
                        $("#ScanIn").select();
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("Error: Returning Badge /" + thrownError);
                    $("#myPleaseWait").modal('hide');
                }
            });
        }
        function fn_ChangeDates()
        {
            $("#myPleaseWait").modal('show');
            var Th = $("#th").is(':checked');
            var Fr = $("#fr").is(':checked');
            var Sa = $("#sa").is(':checked');
            var Su = $("#su").is(':checked');
            var Fd = $("#fd").is(':checked');
            var URL = "BadgeTotals?Th=" + Th + "&Fr=" + Fr + "&Sa=" + Sa + "&Su=" + Su + "&Fd=" + Fd;
            $.ajax({
                url: URL,
                async: false,
                type: 'GET',
                success: function (result) {
                    BadgeTable.destroy();
                    $("#BadgeTable > tbody").empty();
                    var BadgeIn = 0;
                    var BadgeOut = 0;
                    jQuery.each(result, function (index, item) {
                        BadgeIn += ((item.Status) ? 1 : 0);
                        BadgeOut += ((item.Status) ? 0 : 1);
                        var NewRec = "<tr class=\"TableTr\"><td style=\"text-align:center; border:none;\"><a href=\"#\" title=\"" + item.Info + "\" onclick=\"fn_DisplayHistory('" + item.Badge + "');\">" + item.Badge + "</a></td>";
                        NewRec += "<td style=\"text-align:center; border:none;\">" + ((item.Status) ? "IN" : "OUT") + "</td></tr>";
                        $("#BadgeTable > tbody").append(NewRec);
                    });
                    var BadgeTotal = parseInt(BadgeIn) + parseInt(BadgeOut);
                    var NewTitle = "IN:" + BadgeIn + " OUT:" + BadgeOut + " TOTAL:" + BadgeTotal;

                    $("#BadgeTotals").text(NewTitle);
                    $("#myPleaseWait").modal('hide');
                    BadgeTable = $('#BadgeTable').DataTable({
                        "destroy": true,
                        "autoWidth": true,
                        "ordering": true,
                        "scrollY": '60vh',
                        "scrollCollapse": true,
                        "paging": false,
                        "searching": true,
                        "info": false,
                        "order": [[0, "asc"]]
                    });
                    setTimeout(function () {
                        $("#BASearch").val("");
                        $("#ScanIn").val("");
                        $("#ScanIn").focus();
                    }, 1000);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("Error: Getting Badges /" + thrownError);
                    $("#myPleaseWait").modal('hide');
                }
            });
        }
        function fn_DisplayHistory(Badge) {
            $("#myPleaseWait").modal('show');
            var URL = "BadgeHistory?Badge=" + Badge;
            $.ajax({
                url: URL,
                async: false,
                type: 'GET',
                success: function (result) {
                    HistoryTable.destroy();
                    $("#myPleaseWait").modal('hide');
                    $("#BadgeHistoryDiv").modal('show');
                    $("#HistoryTable > tbody").empty();
                    $("#HistoryTitle").text("Badge: " + Badge);
                    jQuery.each(result, function (index, item) {
                        var NewRec = "<tr><td>" + item.Created + "</td>";
                        NewRec += "<td>" + item.Source + "</td>";
                        NewRec += "<td>" + item.FullName + "</td>";
                        NewRec += "<td>" + item.Info + "</td>";
                        NewRec += "<td>" + item.CreatedSort + "</td></tr>";
                        $("#HistoryTable > tbody").append(NewRec);
                    });
                    HistoryTable = $('#HistoryTable').DataTable({
                        "destroy": true,
                        "autoWidth": true,
                        "ordering": true,
                        "scrollY": '40vh',
                        "scrollCollapse": true,
                        "paging": false,
                        "searching": false,
                        "info": false,
                        "columnDefs": [
                            { targets: [4], visible: false },
                            { targets: [0], iDataSort: 4 }
                        ],
                        "order": [[0, "desc"]]
                    });
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("Error: Getting Badge History /" + thrownError);
                    $("#myPleaseWait").modal('hide');
                }
            });
        }
        function fn_PickEvent(Source, Event_ID) {
            var Url = "../Masters/EventPage?Event_ID=" + Event_ID;
            launchApplication(Url, Source);
            setTimeout(function () {
                $("#ScanIn").val("");
                $("#ScanIn").focus();
            }, 1000);
        }
        $(document).ready(function () {
            $(".NavBar").css("background-color", "");
            $("#MA").css("background-color", "#353535");
            if ($(window).width() > 1135) {
                $("#IconBar2").show();
                $("#wrapper").toggleClass("toggled");
            } else
                $("#IconBar").show();
            $("#SearchWrapper9").show();
            $("#LoginWrapper").show();
            $("#EventsDiv").show();
            HistoryTable = $('#HistoryTable').DataTable({
                "destroy": true,
                "autoWidth": true,
                "ordering": true,
                "scrollY": '40vh',
                "scrollCollapse": true,
                "paging": false,
                "searching": false,
                "info": false,
                "columnDefs": [
                    { targets: [4], visible: false },
                    { targets: [0], iDataSort: 4 }
                ],
                "order": [[0, "desc"]]
            });
            EventsTable = $('#EventsTable').DataTable({
                "ordering": true,
                "scrollY": '500px',
                "scrollCollapse": true,
                "paging": false,
                "searching": false,
                "info": false,
                "autowidth": false
            });
            $("#BadgeDiv").show();
            BadgeTable = $('#BadgeTable').DataTable({
                "ordering": true,
                "scrollY": '60vh',
                "scrollCollapse": true,
                "paging": false,
                "searching": true,
                "info": false,
                "autowidth": false
            });
            $('#BASearch').keyup(function () {
                BadgeTable.search($(this).val()).draw();
            })
            fn_ChangeDates();
        });
    </script>
}
<div id="MyDashboardWrapper" style="margin-top:-10px; background-color:transparent; z-index:1;">
    <div class="MainDiv" style="clear:both; display:block; text-align:center; width:99%; max-width:99%; float:left; position:relative;">
        <div style="display:block; text-align:center; width:100%; ">
            <div id="LeftSide" style="display:inline-block; vertical-align:top;">
                <div id="EventsDiv" style="display:none; margin:10px; padding:10px; float:left; border-radius:4px; background-color:#3691E6; box-shadow:0 2px 8px 0 rgba(53, 53, 53, 0.5);">
                    <label style="color:white; font-size:24pt; font-weight:300; line-height:1.27; float:left;">Events</label>
                    <div style="clear:both; float:left;">
                        <table id="EventsTable" class="table-bordered table-condensed" style="border-radius:4px; background-color:#ffffff; box-shadow:0 2px 8px 0 rgba(53, 53, 53, 0.08);">
                            <thead>
                                <tr style="height:30px;">
                                    <th style="text-align:center; border:none; border-bottom:solid black 1px;">DUE</th>
                                    <th style="text-align:center; border:none; border-bottom:solid black 1px;">Date</th>
                                    <th style="text-align:center; border:none; border-bottom:solid black 1px;">Event</th>
                                    <th style="text-align:right; border:none; border-bottom:solid black 1px;">Pend</th>
                                    <th style="text-align:right; border:none; border-bottom:solid black 1px; ">I/H</th>
                                    <th style="text-align:right; border:none; border-bottom:solid black 1px; ">Inv</th>
                                    <th style="text-align:right; border:none; border-bottom:solid black 1px; ">Count</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr class="TableTr" id="TR_@item.Event_ID" onclick="fn_PickEvent('@item.Event_Name', @item.Event_ID);">
                                        <td style="text-align:center; border:none;">@item.DUE</td>
                                        <td style="text-align:left; border:none;">@item.Event_Date</td>
                                        <td style="text-align:left; border:none;"><a href="#" title="@item.EventHover">@item.Event_Name</a></td>
                                        <td style="text-align:right; border:none;">@item.Pending</td>
                                        <td style="text-align:right; border:none;">@item.InHand</td>
                                        <td style="text-align:right; border:none;">@item.Inventory</td>
                                        <td style="text-align:right; border:none;">@item.Count</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="RightSide" style="display:inline-block;">
                <div id="BadgeDiv" style="display:none; text-align:center; margin:10px; width:230px; float:left; border-radius:4px; background-color:#3691E6; box-shadow:0 2px 8px 0 rgba(53, 53, 53, 0.5);">
                    <div style="display:inline-block; margin-top:10px; font-size:14pt; color:white; ">
                        <input type="checkbox" id="th" style="margin:3px;" onchange="fn_ChangeDates();" checked="checked">Th
                        <input type="checkbox" id="fr" style="margin:3px;" onchange="fn_ChangeDates();" checked="checked">Fr
                        <input type="checkbox" id="sa" style="margin:3px;" onchange="fn_ChangeDates();" checked="checked">Sa
                        <input type="checkbox" id="su" style="margin:3px;" onchange="fn_ChangeDates();" checked="checked">Su
                        <input type="checkbox" id="fd" style="margin:3px;" onchange="fn_ChangeDates();" checked="checked">4Day
                    </div>
                    <div id="SearchDiv" style="clear:both; display:block; margin-top:10px;">
                        <input id="BASearch" />
                    </div>
                    <div id="TableDiv" style="clear:both; display:inline-block; text-align:center;">
                        <table id="BadgeTable" class="table-bordered table-condensed" style="margin-left:auto; margin-right:auto; border-radius:4px; background-color:#ffffff; box-shadow:0 2px 8px 0 rgba(53, 53, 53, 0.08);">
                            <thead>
                                <tr style="height:30px;">
                                    <th style="text-align:center; border:none; border-bottom:solid black 1px;">Badge</th>
                                    <th style="text-align:center; border:none; border-bottom:solid black 1px;">Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div style="clear:both; display:inline-block; text-align:center;color:white;">
                        <label id="BadgeTotals" style="font-size:14pt; font-weight:100; ">@ViewData["Counts"]</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal loadingModal" id="BadgeHistoryDiv" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" style="margin-top:185px;">
    <div class="modal-dialog modal-lg" style="border-radius:4px;">
        <div class="modal-content" style="border-radius:6px; background-color:#f5f5f5;">
            <div class="modal-header" style="margin:10px; height:72px; border-radius:6px; background-color:#1c81db; padding:0px;">
                <label id="HistoryTitle" style="margin:14px; text-align:left; font-size:24pt; color:white; float:left;"></label>
                <div style="text-align:center; float:right;">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="margin:14px; background-color:#aec72d; color:#ffffff;">Close</button>
                </div>
            </div>
            <div class="modal-body" style="">
                <table id="HistoryTable" class="table-bordered table-condensed" style="width:100%;border-radius:4px; box-shadow:0 2px 8px 0 rgba(53, 53, 53, 0.08); background-color:white;" border="1">
                    <thead>
                        <tr style="height:30px;">
                            <th style="text-align:center;">Created</th>
                            <th style="text-align:center;">Source</th>
                            <th style="text-align:center;">Name</th>
                            <th style="text-align:center;">Info</th>
                            <th>CreatedSort</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
